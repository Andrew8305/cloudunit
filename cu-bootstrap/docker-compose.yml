version: '3'
services:

  rabbitmq:
    container_name: cu-mq
    image: rabbitmq:3.6.8-alpine
    environment:
      - "TZ=${TZ}"
    volumes:
      - "rabbitmq-data:/var/lib/rabbitmq"
    labels:
      - "traefik.enable=false"

  mongo:
    container_name: cu-mongo
    environment:
      - "TZ=${TZ}"
    image: mongo:3.4.2
    volumes:
      - mongo-data:/data/db
      - mongo-config:/data/configdb
    labels:
      - "traefik.enable=false"

  redis:
    container_name: cu-redis
    image: redis:3.0.7
    command: redis-server --appendonly yes
    environment:
        - "TZ=${TZ}"
    volumes:
        - redis-data:/data
    labels:
        - "traefik.enable=false"

  traefik:
    container_name: cu-traefik
    image: traefik:1.3
    command: --web --docker --docker.domain=${CU_DOMAIN} --logLevel=DEBUG --docker.exposedbydefault=true --docker.watch=true
    environment:
        - "TZ=${TZ}"
    ports:
        - "80:80"
        - "443:443"
        - "9090:8080"
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./cu-traefik/traefik.toml:/traefik.toml
        - ./cu-traefik/certs:/certs
    labels:
      - "traefik.enable=false"

  domain:
    container_name: cu-domain
    image: cloudunit/domain:latest
    labels:
       - "traefik.enable=false"

  orchestrator:
    container_name: cu-orchestrator
    image: cloudunit/orchestrator:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - "traefik.enable=false"

volumes:
  mongo-data:
  mongo-config:
  traefik-certs:
  redis-data:
  rabbitmq-data:

